import React,{createContext,useContext,useState,useEffect}from'react';import{api}from'../lib/api';const C=createContext(null);export const useAuth=()=>useContext(C);export default function Provider({children}){const[token,setToken]=useState(localStorage.getItem('token')||'');const[user,setUser]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState('');useEffect(()=>{if(token){localStorage.setItem('token',token);api('/users/me',{token}).then(r=>setUser(r.user)).catch(()=>setUser(null))}else{localStorage.removeItem('token');setUser(null)}},[token]);const login=async(email,password)=>{setError('');setLoading(true);try{const r=await api('/auth/login',{method:'POST',body:{email,password}});setToken(r.token)}catch(e){setError(e.message)}finally{setLoading(false)}};const register=async(payload)=>{setError('');setLoading(true);try{const r=await api('/auth/register',{method:'POST',body:payload});setToken(r.token)}catch(e){setError(e.message)}finally{setLoading(false)}};const logout=()=>{setToken('');localStorage.removeItem('token')};return <C.Provider value={{token,user,loading,error,login,register,logout}}>{children}</C.Provider>}
