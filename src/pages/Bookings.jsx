import React,{useEffect,useState}from'react';import{api}from'../lib/api';import{useAuth}from'../context/AuthContext';export default function Bookings(){const{token}=useAuth();const[services,setServices]=useState([]);const[rows,setRows]=useState([]);const[serviceId,setServiceId]=useState('');const[date,setDate]=useState('');const[notes,setNotes]=useState('');const[error,setError]=useState('');useEffect(()=>{api('/services').then(d=>setServices(d.services||[])).catch(()=>{});api('/bookings/me',{token}).then(d=>setRows(d.bookings||[])).catch(e=>setError(e.message))},[token]);const create=async e=>{e.preventDefault();try{await api('/bookings',{method:'POST',token,body:{service_id:serviceId,date,notes}});const d=await api('/bookings/me',{token});setRows(d.bookings||[]);setServiceId('');setDate('');setNotes('')}catch(err){setError(err.message)}};return(<div><h2>My Bookings</h2>{error&&<div className='alert'>{error}</div>}<form onSubmit={create} className='row'><div className='col'><label>Service</label><select value={serviceId} onChange={e=>setServiceId(e.target.value)}><option value=''>Select service</option>{services.map(s=><option key={s.id} value={s.id}>{s.name} â€” ${Number(s.price).toFixed(2)}</option>)}</select></div><div className='col'><label>Date/Time (UTC)</label><input type='datetime-local' value={date} onChange={e=>setDate(e.target.value)}/></div><div className='col'><label>Notes</label><input value={notes} onChange={e=>setNotes(e.target.value)} placeholder='anything to add?'/></div><div className='col' style={{alignSelf:'end'}}><button>Create Booking</button></div></form><table className='table' style={{marginTop:16}}><thead><tr><th>Service</th><th>Date</th><th>Status</th><th>Notes</th></tr></thead><tbody>{rows.map(r=>(<tr key={r.id}><td>{r.service_name||r.service_id?.slice(0,8)}</td><td>{new Date(r.date).toLocaleString()}</td><td><span className='badge'>{r.status}</span></td><td>{r.notes||'-'}</td></tr>))}</tbody></table>{!rows.length&&<div className='muted'>No bookings yet.</div>}</div>)}
