import React,{useEffect,useState}from'react';import{Link}from'react-router-dom';import{api}from'../lib/api';import{useAuth}from'../context/AuthContext';export default function Services(){const[rows,setRows]=useState([]);const[error,setError]=useState('');const{user}=useAuth();useEffect(()=>{api('/services').then(d=>{const list=Array.isArray(d)?d:d.services||d.data?.services||d.data||[];const normalized=list.map((it,i)=>({id:it.id??it.service_id??it.uuid??`service-${i}`,name:it.name??it.service_name??it.title??'Untitled',category:it.category??it.type??it.service_type??'',price:Number(it.price??(typeof it.price_cents==='number'?it.price_cents/100:it.rate))||0,providerName:it.provider_name??it.provider?.name??it.providerName??'',providerId:it.provider_id??it.provider?.id??it.providerId??''}));setRows(normalized)}).catch(e=>setError(e.message))},[]);return(<div><div style={{display:'flex',alignItems:'center',gap:8}}><h2 style={{flex:1}}>Services</h2>{user&&<Link to='/services/new' className='badge'>+ New service</Link>}</div>{error&&<div className='alert'>{error}</div>}<table className='table'><thead><tr><th>Name</th><th>Category</th><th>Price</th><th>Provider</th></tr></thead><tbody>{rows.map(r=>(<tr key={r.id}><td>{r.name}</td><td>{r.category||'-'}</td><td>${Number(r.price).toFixed(2)}</td><td>{r.providerName||r.providerId?.slice(0,8)||'-'}</td></tr>))}</tbody></table>{!rows.length&&<div className='muted'>No services yet.</div>}</div>)}
